+++
title = "XV6-2020 LAB1-UTIL"
date = 2025-06-04
draft = false
[taxonomies]
tags = ["xv6"]
[extra]
toc = true
display_published = true 
author = "aethernet"
+++
事先声明，我写的博客，操作基本都是在ARCH LINUX上实现的。

这是XV6-2020的第一个LAB，主要是初步认识RISC-V版的XV6，然后为其实现一些用户态的小工具。

## boot xv6 (easy)
首先，先下载git，再clone下来xv6-labs-2020的文件。
```sh
sudo -S pacman git

git clone git://g.csail.mit.edu/xv6/labs-2020
cd xv6-labs-2020
git checkout util
make clean && make qemu
```

> 如果跑不了的话，可能是因为你的QEMU太新了，也有可能是其它问题。
> 你可以试试给QEMU降级，或者去学习使用PODMAN或DOCKER（并不难）。

## sleep (easy)

在user目录里，创建名为sleep.c的文件。
```tree
xv6-labs-2020/
|-- user/
|-- |-- sleep.c
```

调用sleep系统调用来实现这个功能。
```sleep.c
#include "kernel/types.h"
#include "kernel/stat.h"
#include "user/user.h"

int main (int argc, char *argv[])
{
    // is argument 2? (sleep 10)(argument 1, argument 2)
    if (argc != 2)
    {
        fprintf (2, "USAGE: sleep <ticks>\n");
        exit(1);
    }
    
    // change time(char*) to integer
    int ticks = atoi(argv[1]);
    // int adjusted_ticks = ticks * 10; make tick argument to second 
    
    // if the tick argument smaller than 0, then it should be 0. 
    if (adjusted_ticks < 0)
    {
        adjusted_ticks = 0;
    }

    sleep(adjusted_ticks);

    exit(0);
}
```

在Makefile的UPROGS处添加$U/_sleep\
```Makefile
UPROGS=\
	$U/_cat\
	$U/_echo\
	$U/_forktest\
	$U/_grep\
	$U/_init\
	$U/_kill\
	$U/_ln\
	$U/_ls\
	$U/_mkdir\
	$U/_rm\
	$U/_sh\
	$U/_stressfs\
	$U/_usertests\
	$U/_grind\
	$U/_wc\
	$U/_zombie\
	$U/_sleep\ # add this, just remember, everytime u make a new file in user/, add here also.
```
