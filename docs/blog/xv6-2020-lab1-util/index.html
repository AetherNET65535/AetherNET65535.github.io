<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="index, follow" name=robots><link href=https://aethernet65535.github.io/rss.xml rel=alternate title=RSS type=application/rss+xml><title>anemone | XV6-2020 LAB1-UTIL</title><link as=style href=https://aethernet65535.github.io/css/style.css rel=preload><link crossorigin href=https://raw.githack.com/Speyll/suCSS/main/reset-min.css rel=stylesheet><link crossorigin href=https://raw.githack.com/Speyll/suCSS/main/suCSS-min.css rel=stylesheet><link href=https://aethernet65535.github.io/css/style.css rel=stylesheet><link href=https://aethernet65535.github.io/css/custom.css rel=stylesheet><link href=https://aethernet65535.github.io/favicon.ico rel=icon><body><nav id=nav-bar><a href=/> /home/ </a><a href=/about> /about/ </a><a href=/journal> /journal/ </a><a href=/blog> /blog/ </a><div aria-label="Toggle theme" class=theme-toggle data-icon-base=https://aethernet65535.github.io/icons.svg data-icon-dark=#darkMode data-icon-light=#lightMode data-sound-src=https://aethernet65535.github.io/click.ogg id=theme-toggle role=button tabindex=0><svg class=icon><use id=theme-icon></use></svg></div></nav><main><article class=post><header class=post-header><time datetime=2025-06-04>Published on: <span class=accent-data>2025-06-04</span> </time><address rel=author>By <span class=accent-data>aethernet</span></address><h1>XV6-2020 LAB1-UTIL</h1></header><div class=toc-container><h2>Table of content</h2><ul><li><a href=https://aethernet65535.github.io/blog/xv6-2020-lab1-util/#boot-xv6-easy>boot xv6 (easy)</a><li><a href=https://aethernet65535.github.io/blog/xv6-2020-lab1-util/#sleep-easy>sleep (easy)</a></ul></div><div class=post-content><p>事先声明，我写的博客，操作基本都是在ARCH LINUX上实现的。<p>这是XV6-2020的第一个LAB，主要是初步认识RISC-V版的XV6，然后为其实现一些用户态的小工具。<h2 id=boot-xv6-easy>boot xv6 (easy)</h2><p>首先，先下载git，再clone下来xv6-labs-2020的文件。<pre class=language-sh data-lang=sh><code class=language-sh data-lang=sh>sudo -S pacman git

git clone git://g.csail.mit.edu/xv6/labs-2020
cd xv6-labs-2020
git checkout util
make clean && make qemu
</code></pre><blockquote><p>如果跑不了的话，可能是因为你的QEMU太新了，也有可能是其它问题。 你可以试试给QEMU降级，或者去学习使用PODMAN或DOCKER（并不难）。</blockquote><h2 id=sleep-easy>sleep (easy)</h2><p>在user目录里，创建名为sleep.c的文件。<pre class=language-tree data-lang=tree><code class=language-tree data-lang=tree>xv6-labs-2020/
|-- user/
|-- |-- sleep.c
</code></pre><p>调用sleep系统调用来实现这个功能。<pre class=language-sleep.c data-lang=sleep.c><code class=language-sleep.c data-lang=sleep.c>#include "kernel/types.h"
#include "kernel/stat.h"
#include "user/user.h"

int main (int argc, char *argv[])
{
    // is argument 2? (sleep 10)(argument 1, argument 2)
    if (argc != 2)
    {
        fprintf (2, "USAGE: sleep &LTticks>\n");
        exit(1);
    }
    
    // change time(char*) to integer
    int ticks = atoi(argv[1]);
    // int adjusted_ticks = ticks * 10; make tick argument to second 
    
    // if the tick argument smaller than 0, then it should be 0. 
    if (adjusted_ticks < 0)
    {
        adjusted_ticks = 0;
    }

    sleep(adjusted_ticks);

    exit(0);
}
</code></pre><p>在Makefile的UPROGS处添加$U/_sleep\<pre class=language-Makefile data-lang=Makefile><code class=language-Makefile data-lang=Makefile>UPROGS=\
	$U/_cat\
	$U/_echo\
	$U/_forktest\
	$U/_grep\
	$U/_init\
	$U/_kill\
	$U/_ln\
	$U/_ls\
	$U/_mkdir\
	$U/_rm\
	$U/_sh\
	$U/_stressfs\
	$U/_usertests\
	$U/_grind\
	$U/_wc\
	$U/_zombie\
	$U/_sleep\ # add this, just remember, everytime u make a new file in user/, add here also.
</code></pre></div><div class=post-tags><a class=tag href=/tags/xv6>#xv6 </a></div></article></main><footer><hr><div id=footer-container><p>Made using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> Zola theme</div></footer><script defer src=https://aethernet65535.github.io/js/script.js></script>